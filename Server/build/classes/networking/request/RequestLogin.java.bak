/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package networking.request;

// Java Imports
import core.Player;

import java.io.IOException;


// Custom Imports
//import core.GameServer;
import networking.response.ResponseLogin;
import networking.response.ResponseCreateCharacter;
import utility.DataReader;
/**
 *
 * @author adrien
 */
public class RequestLogin extends GameRequest {

    // Data
    private String username;
    private String password;

// Responses
    private ResponseLogin responseLogin;

    public RequestLogin() {
        responses.add(responseLogin = new ResponseLogin());
    }

    @Override
    public void parse() throws IOException {
        setUsername(DataReader.readString(dataInput));
        setPassword(DataReader.readString(dataInput));

    }

    @Override
    public void doBusiness() throws Exception {
      //TODO: Un-comment next two lines
    	// DBHandler dbHandler = new DBHandler();
    	// Boolean validate = dbHandler.processLogin(username, password);

      //TODO: Take out the next line
      Boolean validate = true;

    	this.client.setPlayerId(username);
    	this.setPlayerId(username);
        //If the user successfully validated,
        if (validate == true) {
        	this.client.getServer().addActivePlayer(username, new Player(username));
            //He enters the world, we have to send him the informations about the other players

            for (Player  player : this.client.getServer().getActivePlayers().values()) {
                if(!player.getId().equalsIgnoreCase(this.getUsername()))
                {
                    ResponseCreateCharacter newChar = new ResponseCreateCharacter();
                    newChar.setData(player.getId(), player.getType(),player.getX(), player.getY(), player.getZ());
                    responses.add(newChar);
                }
            }
    	}

        responseLogin.setData(validate, playerId, this.client.getServer().getActivePlayer(username).getType());
    }

	public String getUsername() {
		return username;
	}

	public void setUsername(String username) {
		this.username = username;
	}

	public String getPassword() {
		return password;
	}

	public void setPassword(String password) {
		this.password = password;
	}
}
